<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <body>

        <ui:composition template="./template.xhtml">

            <ui:define name="title">
                Shopping Cart
            </ui:define>

            <ui:define name="content">
                <div id="cartTopRow">
                    <div class="cartBox">
                        <c:choose>
                            <c:when test="${cart.numberOfItems > 1}">
                                <p>Your shopping cart contains ${cart.numberOfItems} items.</p>
                            </c:when>
                            <c:when test="${cart.numberOfItems == 1}">
                                <p>Your shopping cart contains ${cart.numberOfItems} item.</p>
                            </c:when>
                            <c:otherwise>
                                <p>Your shopping cart is empty.</p>
                            </c:otherwise>
                        </c:choose>
                    </div>

                    <div class="cartMidBox">
                        <%-- clear cart widget --%>
                        <c:if test="${!empty cart && cart.numberOfItems != 0}">
                            <c:url var="url" value="viewCart">
                                <c:param name="clear" value="true"/>
                            </c:url>
                            <a href="${url}" class="cartMidBoxText">clear cart</a>
                        </c:if>

                        <c:set var="value">
                            <c:choose>
                                <%-- if 'selectedCategory' session object exists, send user to previously viewed category --%>
                                <c:when test="${!empty selectedCategory}">
                                    category.jsp
                                </c:when>
                                <%-- otherwise send user to welcome page --%>
                                <c:otherwise>
                                    index.jsp
                                </c:otherwise>
                            </c:choose>
                        </c:set>

                        <%-- checkout widget --%>
                        <c:if test="${!empty cart && cart.numberOfItems != 0}">
                            <a href="checkout" class="cartMidBoxText">proceed to checkout &#x279f;</a>
                        </c:if>
                    </div>

                    <div class="cartBox">
                        <c:if test="${!empty cart && cart.numberOfItems != 0}">
                            <h4 id="subtotal">subtotal: &euro; ${cart.subtotal}</h4>
                            <table id="cartTable">
                                <tr class="tableContent">
                                    <th>product</th>
                                    <th>name</th>
                                    <th>price</th>
                                    <th>quantity</th>
                                </tr>
                                <c:forEach var="cartItem" items="${cart.items}" varStatus="iter">
                                    <c:set var="product" value="${cartItem.product}"/>
                                    <tr class="${((iter.index % 2) == 0) ? 'lightBlue' : 'white'}">
                                        <td>
                                            <img src="${initParam.productImagePath}${product.name}.png" alt="${product.name}">
                                        </td>
                                        <td>${product.name}</td>
                                        <td>
                                            &euro; ${cartItem.total}<br>
                                                <span class="smallText">( &euro; ${product.price} / unit )</span>
                                        </td>
                                        <td>
                                            <form action="updateCart" method="post">
                                                <input type="hidden"
                                                       name="productId"
                                                       value="${product.id}">
                                                    <input type="text"
                                                           maxlength="2"
                                                           size="2"
                                                           value="${cartItem.quantity}"
                                                           name="quantity"
                                                           style="margin:5px">
                                                        <input type="submit"
                                                               name="submit"
                                                               value="update">
                                                            </form>
                                                            </td>
                                                            </tr>
                                                            </c:forEach>
                                                            </table>
                                                            </c:if>
                                                            </div>
                                                            </div>
                                                            </ui:define>

                                                            </ui:composition>

                                                            </body>
                                                            </html>
